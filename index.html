<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Consulta de Tickers</title>

    <!-- Cargar Bootstrap 5 desde un CDN -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      integrity="sha384-ENjdO4Dr2bkBIFxQX7I1C7e1hXii+14lTnLDvQkrRz8b2nOHGJmK6zP4M4Z7Tub5"
      crossorigin="anonymous"
    />
    <style>
      /* Puedes añadir ajustes adicionales aquí si quieres refinar el estilo */
      #spinner {
        font-style: italic;
      }
      #errorMsg {
        color: red;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <h1 class="mb-4">Consulta de Tickers</h1>

      <form id="tickerForm" class="row g-3">
        <div class="col-auto">
          <label for="tickerInput" class="visually-hidden">Ticker</label>
          <input
            type="text"
            class="form-control"
            id="tickerInput"
            placeholder="Ej: HOOD o NVDA"
          />
        </div>
        <div class="col-auto">
          <button type="submit" class="btn btn-primary mb-3">Buscar</button>
        </div>
      </form>

      <div id="spinner" class="text-muted" style="display: none;">Cargando datos...</div>
      <div id="errorMsg" class="text-danger" style="display: none;"></div>

      <div id="contenido" style="display: none;">
        <div class="table-responsive">
          <table class="table table-bordered table-hover">
            <thead class="table-light">
              <tr>
                <th>Atributo</th>
                <th>Valor</th>
              </tr>
            </thead>
            <tbody id="datosTabla"></tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      const form = document.getElementById("tickerForm");
      const tickerInput = document.getElementById("tickerInput");
      const spinner = document.getElementById("spinner");
      const errorMsg = document.getElementById("errorMsg");
      const contenido = document.getElementById("contenido");
      const datosTabla = document.getElementById("datosTabla");

      form.addEventListener("submit", (e) => {
        e.preventDefault(); // Evita el comportamiento por defecto del form

        const ticker = tickerInput.value.trim();
        if (!ticker) {
          alert("Introduce un ticker válido");
          return;
        }

        // Limpia mensajes/tabla previos
        datosTabla.innerHTML = "";
        spinner.style.display = "block";
        errorMsg.style.display = "none";
        contenido.style.display = "none";

        // URL de tu Cloud Function
        const FUNCTION_URL = "https://tickers-stats-714254943648.europe-southwest1.run.app/get_ticker_stats"; 
        const urlConTicker = `${FUNCTION_URL}?ticker=${ticker}`;

        fetch(urlConTicker)
          .then((response) => {
            if (!response.ok) {
              throw new Error(`Error de servidor: ${response.status} ${response.statusText}`);
            }
            return response.json();
          })
          .then((data) => {
            spinner.style.display = "none";
            contenido.style.display = "block";

            // Rellenamos la tabla
            for (let key in data) {
              const row = document.createElement("tr");
              const cellKey = document.createElement("td");
              const cellVal = document.createElement("td");

              cellKey.textContent = key;
              if (typeof data[key] === "object" && data[key] !== null) {
                cellVal.textContent = JSON.stringify(data[key], null, 2);
              } else {
                cellVal.textContent = data[key];
              }

              row.appendChild(cellKey);
              row.appendChild(cellVal);
              datosTabla.appendChild(row);
            }
          })
          .catch((error) => {
            spinner.style.display = "none";
            errorMsg.style.display = "block";
            errorMsg.textContent = `Error al cargar datos: ${error.message}`;
          });
      });
    </script>

    <!-- JS de Bootstrap (opcional si necesitas componentes interactivos) -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+UcmB7Mw5E6Bp4yXvf5suZo3h7KZi"
      crossorigin="anonymous"
    ></script>
  </body>
</html>

